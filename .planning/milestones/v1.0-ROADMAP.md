# Milestone v1.0: MVP

**Status:** âœ… SHIPPED 2026-02-02
**Phases:** 1-5 (plus 3.1 inserted)
**Total Plans:** 11

## Overview

This milestone delivered a complete set of ComfyUI custom nodes that enable batch processing of images through any pipeline. The journey started with foundational node infrastructure (proper registration, tensor handling), then built the core loader and saver nodes, implemented the queue-per-image execution pattern for iteration, and finished with progress tracking and live UI updates. Each phase delivered independently testable functionality.

## Phases

### Phase 1: Foundation

**Goal**: Users can load images from a directory with a properly registered ComfyUI node
**Depends on**: Nothing (first phase)
**Requirements**: LOAD-01, LOAD-02, LOAD-03, LOAD-04, LOAD-05, LOAD-06
**Plans**: 2 plans

Plans:
- [x] 01-01-PLAN.md - Project structure, node registration, utilities (natural sort, image loading)
- [x] 01-02-PLAN.md - Complete BatchImageLoader implementation with filtering and validation

**Success Criteria:**
1. BatchImageLoader node appears in ComfyUI's "Add Node" menu under a custom category
2. User can specify a directory path and see images loaded in natural sort order (img2 before img10)
3. User can filter images using glob patterns (e.g., `*.png`)
4. Node outputs current image, total count, and current filename as separate outputs

### Phase 2: Image Saving

**Goal**: Users can save processed images with customizable output paths and filenames
**Depends on**: Phase 1
**Requirements**: SAVE-01, SAVE-02, SAVE-03, SAVE-04, SAVE-05, SAVE-06, SAVE-07, SAVE-08, SAVE-09
**Plans**: 2 plans

Plans:
- [x] 02-01-PLAN.md - Save image utilities and BatchImageSaver node implementation
- [x] 02-02-PLAN.md - Node registration and integration verification

**Success Criteria:**
1. BatchImageSaver node accepts output directory and saves images immediately upon receiving them
2. Output filenames preserve the original source filename with optional prefix/suffix
3. User can save as PNG, JPG (with quality), or WebP (with quality)
4. When no output directory specified, images save to a folder named after the input directory

### Phase 3: Batch Iteration

**Goal**: Users can process an entire directory by running the workflow once, with each image flowing through separately
**Depends on**: Phase 1, Phase 2
**Requirements**: ITER-01, ITER-02, ITER-03, ITER-04, ITER-05
**Plans**: 2 plans

Plans:
- [x] 03-01-PLAN.md - Iteration state management and queue control utilities
- [x] 03-02-PLAN.md - Extend BatchImageLoader with iteration support

**Success Criteria:**
1. Clicking "Queue" once triggers processing of all images in the directory (one workflow execution per image via Auto Queue)
2. User can interrupt processing at any time via ComfyUI's cancel/interrupt
3. Each image processes in order through the full pipeline before the next begins
4. Nodes correctly output current index (0-based) and total count for each iteration

### Phase 3.1: Native Queue Control (INSERTED)

**Goal**: Batch iteration works without any external node dependencies (no Impact Pack required)
**Depends on**: Phase 3
**Requirements**: Derived from Phase 3 gap - current implementation uses Impact Pack events
**Plans**: 1 plan

Plans:
- [x] 03.1-01-PLAN.md - Native HTTP POST queue control, hidden inputs for workflow access

**Success Criteria:**
1. BatchImageLoader triggers next queue execution using native ComfyUI API (POST /prompt)
2. Batch completion stops iteration without requiring Impact Pack's stop-auto-queue event
3. All existing Phase 3 tests continue to pass
4. No external custom node dependencies required for batch iteration

### Phase 4: Progress & Monitoring

**Goal**: Users have visibility into batch progress with file mappings and image previews
**Depends on**: Phase 3.1
**Requirements**: PROG-01, PROG-02, PROG-03, PROG-04, PROG-05
**Plans**: 2 plans

Plans:
- [x] 04-01-PLAN.md - Extend BatchImageSaver with passthrough outputs, create BatchProgressFormatter node
- [x] 04-02-PLAN.md - Node registration and comprehensive tests

**Success Criteria:**
1. User sees a progress indicator showing "X of Y images processed"
2. User sees a list of original filename to saved filename mappings that updates as each image completes
3. User sees thumbnail previews of input (before) and output (after) images

### Phase 5: Live UI Updates

**Goal**: Frontend UI updates in real-time during batch processing iterations
**Depends on**: Phase 4
**Requirements**: Derived from UAT gaps - UI shows stale data after first iteration
**Plans**: 1 plan

Plans:
- [x] 05-01-PLAN.md - Broadcast UI updates via PromptServer.send_sync with sid=None

**Success Criteria:**
1. INDEX, TOTAL_COUNT outputs update visually for each batch iteration
2. Progress text (BatchProgressFormatter) updates for each image processed
3. Preview nodes show current image, not just first image
4. SAVED_FILENAME and SAVED_PATH update for each iteration

**Root Cause:** trigger_next_queue() generates new client_id; ComfyUI sends execution_success with broadcast=False to original client_id only

---

## Milestone Summary

**Decimal Phases:**
- Phase 3.1: Native Queue Control (inserted after Phase 3 to remove Impact Pack dependency)

**Key Decisions:**

- Use queue-per-image pattern (not in-graph loops) - simpler, crash-safe, works with any downstream nodes
- Graceful imports with try/except for torch/numpy to enable testing without ComfyUI
- Raw filename concatenation - user provides separators in prefix/suffix
- Use urllib.request instead of requests library for guaranteed availability
- stop_auto_queue() simply returns True - stopping is implicit (no event needed)
- Image passthrough uses same tensor reference (no copy) for efficiency
- PromptServer.send_sync() with sid=None for client-agnostic broadcast

**Issues Resolved:**

- Fixed Impact Pack dependency by replacing with native HTTP POST to /prompt
- Fixed UI not updating during batch iterations by adding sid=None broadcasts
- Fixed IS_CHANGED/VALIDATE_INPUTS missing hidden inputs

**Issues Deferred:**

- Index range selection (process only images 50-100) - v2 feature
- Recursive subfolder support - v2 feature
- Resume capability with state persistence - v2 feature

**Technical Debt Incurred:**

- Verbose debug print statements in batch_loader.py and batch_saver.py (intentional for troubleshooting)
- PreviewImage node updates may not respond to custom broadcasts (ComfyUI limitation)

---

*For current project status, see .planning/ROADMAP.md*
*Archived: 2026-02-02 as part of v1.0 milestone completion*
